<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>qi::path Developer Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>


<div id="top"><!-- do not remove this div! -->
<div class="related">
  <ul>
    <!-- <li style="margin-right: 10px" class="right"> -->
    <!--   <a accesskey="I" title="General Index" href="genindex.html">index</a> -->
    <!-- </li> -->
    <!-- <li class="right"> -->
    <!--   <a accesskey="N" title="Whatâ€™s new?" href="news/whatsnew/index.html">next</a> | -->
    <!-- </li> -->
    <li><a href="../../index.html">NAO documentation</a> |</li>
    <li><a href="../../ref/cpp-api.html">C++ Libraries</a> |</li>
    <li><a href="index.html">index</a></li>
  </ul>
</div>


<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libqi
   &#160;<span id="projectnumber">1.12.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceqi_1_1path.html" title="Set of tools to handle SDK layouts.">qi::path</a> Developer Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>go to the <a class="el" href="group__qipath.html">qi::path</a> API reference.</p>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<h3><a class="anchor" id="OverviewSdk"></a>
The SDK Layout</h3>
<p>The main idea of the qibuild-based project is that you always end up with the same layout.</p>
<p>For instance, right after having built you project, you end up with a directory looking like this:</p>
<p>Here we assume you have a <code>foo</code> executable which:</p>
<ul>
<li>depends on a <code>bar</code> dynamic library</li>
<li>need to read data from a file named <code>foo.data</code> </li>
<li>need to read configuration from a file named <code>foo.cfg</code> </li>
</ul>
<div class="fragment"><pre class="fragment">
src
|__ foo
    |__ data
        |___ foo.data
    |__ etc
        |__ foo.cfg

build
|___
    sdk
    |__ lib
         |___ libbar.so
    |__ bin
         |__ foo

</pre></div><p>When everything is installed, you have something like:</p>
<div class="fragment"><pre class="fragment">

prefix
  |__ lib
      |__ libbar.so
  |__ bin
      |__ foo
  |__ share
      |__ foo
          |__ foo.data
  |__ etc
      |__ foo
          |__ foo.cfg


</pre></div><h3><a class="anchor" id="OverviewProblem"></a>
The problem</h3>
<p>Here is a list of common requirements:</p>
<ul>
<li>Find the files <code>foo/foo.cfg</code>, <code>foo/foo.data</code> in a clean, simple way, while making sure the solution works whereas the project is built or installed</li>
</ul>
<ul>
<li>The executable <code>foo</code> may need to write or update its configuration files or data but we need to make sure nothing will be written inside the installed directory</li>
</ul>
<ul>
<li>Since there will be several <code>foo.cfg</code> files, we need to be able to process then in a correct order.</li>
</ul>
<h3><a class="anchor" id="OverviewSolution"></a>
The solution</h3>
<p>Here is how it works:</p>
<ul>
<li>First we introduce the concept of <b>prefix</b>. When something is built, the prefix is <code>/path/to/build/sdk</code>, when something is installed, the prefix is the <code>DESTDIR</code> plus the installation prefix.</li>
</ul>
<ul>
<li>Then we make sure the layout in the build prefix and in the install prefix is always the same. For instance, we will have CMake rules to be sure that whenever the foo project is configured, a copy of <code>foo.cfg</code> is placed in <code>build/sdk/foo/foo.cfg</code> (same thing for data)</li>
</ul>
<ul>
<li>At last, we provide an easy way to get the prefix anywhere from the c++ code. The idea is that it is easy to get the prefix from <code>argv0</code>. For instance, if <code>argv0</code> is <code>/path/to/build/sdk/bin/foo</code>, we can assume the prefix is <code>/path/to/build/sdk</code>.</li>
</ul>
<h2><a class="anchor" id="link"></a>
Link</h2>
<p><a class="el" href="namespaceqi_1_1path.html" title="Set of tools to handle SDK layouts.">qi::path</a> documentation.</p>
<h2><a class="anchor" id="Using"></a>
Using Namespace path</h2>
<h3><a class="anchor" id="Notes"></a>
Notes &amp; Requirement</h3>
<p>The <a class="el" href="namespaceqi_1_1path.html">API of qi::path</a> always make sure that:</p>
<ul>
<li>returned path are absolute, native paths. (with "/" on UNIX and "\" on windows)</li>
<li>path always MUST be in UTF-8 encoding (every methods who need UTF-8 charset is specified in <a class="el" href="namespaceqi_1_1path.html" title="Set of tools to handle SDK layouts.">qi::path</a> "API of qi::path"),</li>
<li>return path will be in UTF-8 charset.</li>
</ul>
<p>For this to work, we must make sure that</p>
<ul>
<li><a class="el" href="group__qi.html#ga0b536bf8de2d544abd2468d80c595943" title="Store argc and argv.">qi::init</a> has been called.</li>
</ul>
<p>Have a look on the <a class="el" href="namespaceqi_1_1path.html">API of qi::path</a> for more details</p>
<h3><a class="anchor" id="Configs"></a>
Reading and writing configuration files</h3>
<p>Writing a configuration file is very different from reading one.</p>
<p>Let's assume the <code>foo</code> executable want to make sure that <code> SPAM=42 </code> in <code>foo.cfg</code>.</p>
<p>Here is how it works:</p>
<ul>
<li>First, ask for a <b>list</b> of possible paths for <code>foo.cfg</code> </li>
</ul>
<ul>
<li>Iterate through this list and stop when the first possible <code>foo.cfg</code> is found</li>
</ul>
<ul>
<li>Read and update the <code>foo.cfg</code> file</li>
</ul>
<ul>
<li>Write the <code>foo.cfg</code> file.</li>
</ul>
<p>You can see that we ask for a <b>list</b> of paths when reading, but that we always write to <b>one</b> file.</p>
<p>Let's go through these steps again, assuming <code>foo</code> is installed in <code>/usr/bin/foo</code>, and <code>foo.cfg</code> in <code>/usr/share/foo/foo</code>.cfg, and that there is nothing else on the machine where <code>foo</code> is running.</p>
<ul>
<li>First step: ask for a list of possible paths for <code>foo.cfg</code> using qi::path::getConfigurationPaths <br/>
 This gives a list looking like : <br/>
 <code> [~/.config/foo/foo.cfg, /usr/share/foo/foo.cfg] </code></li>
</ul>
<ul>
<li>Since <code></code>.config/foo/foo.cfg does not exist, we read <code>/usr/share/foo/foo</code>.cfg</li>
</ul>
<ul>
<li>Then we ask for a location to write: using qi::path::getConfigurationPaths <br/>
 In this case it's ~/.config/foo/foo.cfg <br/>
 So we write <code> SPAM=42 </code> to <code>~/</code>.config/foo/foo.cfg</li>
</ul>
<p>Then each time a piece of code will ask for the <code>foo.cfg</code> path, it will get a list starting with <code>~/</code>.config/foo/foo.cfg, so we are sure the setting <code> SPAM=42 </code> will be used.</p>
<h3><a class="anchor" id="Example"></a>
Example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> * Copyright (c) 2012 Aldebaran Robotics. All rights reserved.</span>
<span class="comment"> * Use of this source code is governed by a BSD-style license that can be</span>
<span class="comment"> * found in the COPYING file.</span>
<span class="comment"> */</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;fstream&gt;</span>
<span class="preprocessor">#include &lt;vector&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="os_8hpp.html">qi/os.hpp</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="path_8hpp.html" title="find bin/lib/data/conf for the current application">qi/path.hpp</a>&gt;</span>
<span class="preprocessor">#include &lt;qi/qi.hpp&gt;</span>

<span class="preprocessor">#include &lt;boost/locale.hpp&gt;</span>
<span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span>
<span class="preprocessor">#include &lt;locale&gt;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
  <span class="comment">// Set the global locale to loc</span>
  std::locale::global(boost::locale::generator().generate(<span class="stringliteral">&quot;&quot;</span>));
  <span class="comment">// Make boost.filesystem use it</span>
  boost::filesystem::path::imbue(std::locale());

  <span class="comment">// Get the prefix name from argv0</span>
  std::cout &lt;&lt; <span class="stringliteral">&quot;argv0 is: &quot;</span> &lt;&lt; argv[0] &lt;&lt; std::endl;
  <span class="comment">// Get the prefix name from argv0</span>
  <span class="comment">// Performs various initializations.</span>
  <span class="comment">// This is usually called by qi::init()</span>
  <a class="code" href="group__qi.html#ga0b536bf8de2d544abd2468d80c595943" title="Store argc and argv.">qi::init</a>(argc, argv);

  <span class="comment">// Get sdk prefix</span>
  std::cout &lt;&lt; <span class="stringliteral">&quot;SDK prefix is: &quot;</span> &lt;&lt; <a class="code" href="group__qipath.html#gac24e444898103867f540b5c151b2d585" title="Return the default SDK prefix path.It&#39;s always a complete, native path.">qi::path::sdkPrefix</a>() &lt;&lt; std::endl;

  <span class="comment">// First argument is the name of the application, used</span>
  <span class="comment">// to build various paths later.</span>
  std::string fooCfgPath = <a class="code" href="group__qipath.html#ga5c6a850547ba5cea80e8a1c0908395de" title="Look for a configuration file.The file is searched in a list of possible directories, the first match is returned.">qi::path::findConf</a>(<span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;foo.cfg&quot;</span>);
  <span class="keywordflow">if</span> (fooCfgPath == <span class="stringliteral">&quot;&quot;</span>)
  {
    std::cerr &lt;&lt; <span class="stringliteral">&quot;Could not find foo.cfg&quot;</span> &lt;&lt; std::endl;
    std::cerr &lt;&lt; <span class="stringliteral">&quot;Looked in: &quot;</span> &lt;&lt; std::endl;
    std::vector&lt;std::string &gt; configPaths = <a class="code" href="group__qipath.html#ga331d7833b193d376132d2e1a264f3e19" title="Get the list of directories used when searching for configuration files for the given application nam...">qi::path::confPaths</a>(<span class="stringliteral">&quot;foo&quot;</span>);
    std::vector&lt;std::string&gt;::const_iterator it;
    <span class="keywordflow">for</span> (it = configPaths.begin(); it != configPaths.end(); ++it)
    {
      std::cerr &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; *it &lt;&lt; std::endl;
    }
  }
  <span class="keywordflow">else</span>
  {
    std::cout &lt;&lt; <span class="stringliteral">&quot;Found foo.cfg: &quot;</span> &lt;&lt; fooCfgPath &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Contents: &quot;</span> &lt;&lt; std::endl;
    <span class="keywordtype">char</span> buf[250];
    std::ifstream ifs;

    <span class="comment">// Set stream to the right charset</span>
    ifs.imbue(std::locale());
    ifs.open(fooCfgPath.c_str(), std::fstream::in);
    <span class="keywordflow">while</span> (! ifs.eof())
    {
      ifs.getline(buf, 250);
      std::cout &lt;&lt; buf &lt;&lt; std::endl;
    }
    ifs.close();
  }


  <span class="comment">// ... Write back the configuration to userCfgPath</span>
  std::string userCfgPath = <a class="code" href="group__qipath.html#gafd05bcc178452a02ccf31cab8331c1a4" title="Get the writable configuration files path for users.">qi::path::userWritableConfPath</a>(<span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;foo.cfg&quot;</span>);
  std::cout &lt;&lt; <span class="stringliteral">&quot;Writing config file to: &quot;</span> &lt;&lt; userCfgPath &lt;&lt; std::endl;
  std::ofstream ofs(userCfgPath.c_str(), std::fstream::out | std::fstream::trunc);
  ofs &lt;&lt; <span class="stringliteral">&quot;Hi, this is foo.cfg&quot;</span> &lt;&lt; std::endl;
  ofs.close();

  <span class="keywordflow">return</span> 0;
}

</pre></div><h3><a class="anchor" id="link"></a>
Link</h3>
<p><a class="el" href="namespaceqi_1_1path.html" title="Set of tools to handle SDK layouts.">qi::path</a> documentation. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Copyright Aldebaran Robotics
<!-- Generated on Wed Mar 14 2012 18:44:13 for libqi by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1</small></address> -->

</body>
</html>
