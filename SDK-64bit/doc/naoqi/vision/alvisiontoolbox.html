
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ALVisionToolbox &mdash; NAO Software 1.12.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.12.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="NAO Software 1.12.3 documentation" href="../../index.html" />
    <link rel="up" title="NAOqi Vision" href="index.html" />
    <link rel="next" title="ALVisionToolbox API" href="alvisiontoolbox-api.html" />
    <link rel="prev" title="ALVisionRecognition Tutorial" href="alvisionrecognition-tuto.html" />

 

<script  type="text/javascript">
   var _gaq = _gaq || [];
   _gaq.push(['_setAccount', 'UA-19487749-1']);
   _gaq.push(['_trackPageview']);
   (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();
</script>


  </head>
  <body>

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      <h1><a href="../../index.html">NAO Software 1.12.3 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>
        
         |
        <a title="Site map" href="../../contents.html">Site map</a>
        
         |
        <a title="Search" href="../../search.html">Search</a>
         |
        <a title="Index" href="../../genindex.html">Index</a>
        
        
      </div>
      <div class="nav">
    &laquo; <a href="alvisionrecognition-tuto.html" title="ALVisionRecognition Tutorial">previous</a>
     |
    <a href="index.html" title="NAOqi Vision" accesskey="U">up</a>
   |
    <a href="alvisiontoolbox-api.html" title="ALVisionToolbox API">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="naoqi-vision-alvisiontoolbox">
            
  <div class="section" id="alvisiontoolbox">
<span id="id1"></span><h1>ALVisionToolbox<a class="headerlink" href="#alvisiontoolbox" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p><a class="reference internal" href="index.html#naoqi-vision"><em>NAOqi Vision</em></a> || Overview | <a class="reference internal" href="alvisiontoolbox-api.html#alvisiontoolbox-api"><em>API</em></a> | <a class="reference internal" href="alvisiontoolbox-tuto.html#alvisiontoolbox-tuto"><em>Tutorials</em></a></p>
<hr class="docutils" />
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference internal" href="../../nao/hardware/video.html#hardware-video"><em>Video camera Hardware</em></a></li>
</ul>
</div>
<div class="section" id="what-it-does">
<h2>What it does<a class="headerlink" href="#what-it-does" title="Permalink to this headline">¶</a></h2>
<p>The <strong>ALVisionToolbox</strong> module is a vision module, aggregating different features
that don&#8217;t justify to have their own module.</p>
<p>You will find here functions that:</p>
<ul class="simple">
<li>tells if NAO is in a bright or dark environment or if there is backlighting,</li>
<li>sets a digital camera mode for shooting pictures in jpeg,</li>
<li>takes and stores pictures regularly with different parameters,</li>
<li>records AVI video file with MJPG compression.</li>
<li>tells NAO to look at his hands to set the camera white balance.</li>
</ul>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<div class="section" id="isitdark">
<h3>IsItDark?<a class="headerlink" href="#isitdark" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>This function returns values between 0 and 255 according to the following light conditions:</dt>
<dd><ul class="first last simple">
<li>[0;4] outdoor</li>
<li>[5;100] indoor bright</li>
<li>[101;127] indoor artificial light</li>
<li>[128;210] indoor weak lights</li>
<li>[211;255] dark place</li>
</ul>
</dd>
</dl>
<p>When calling this function, auto-gain/auto-exposure is turned on for
one second - if they were not before - in order to let the camera adjust automatically
gain and exposure values. Then gain value will be send by the camera itself.</p>
<ul class="simple">
<li>If gain value is lower than its maximum threshold, it is rescaled to fit the
correct range among the ones detailed above.</li>
<li>If gain value is equal to the maximum threshold, an image is grabbed to compute
its average grey value and make the difference between weak lights and a dark place.</li>
</ul>
<p>Checking the camera gain value has two advantages:</p>
<ul class="simple">
<li>avoid mistakes on situations where image is black but gain is low,</li>
<li>save processing time when robot is in a bright environment as CPU don&#8217;t need to process anything.</li>
</ul>
</div>
<div class="section" id="backlighting">
<h3>Backlighting<a class="headerlink" href="#backlighting" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>This function returns the following values:</dt>
<dd><ul class="first last simple">
<li>0: no backlight</li>
<li>1: possible backlight</li>
<li>2 and more: backlight identified</li>
</ul>
</dd>
</dl>
<p>Backlighting occurs when there is high contrast between a light source
(e.g. a window) and the observed scene.</p>
<p>To identify this, the backlighting method analyses first in the current frame
if more than 2% of pixels are clipped
(a phenomenon that occurs when a pixel sensor receives more light that it can
&#8220;store&#8221;, resulting in a &#8216;255&#8217; value after digital conversion for that pixel).
In that case, we check if more than 60% of pixels present a luminance below &#8216;70&#8217;.</p>
<p>The final result of this method is a weighted combination of both the percentage
of pixels at &#8216;255&#8217; and the percentage of pixels below &#8216;70&#8217;.</p>
</div>
<div class="section" id="takepicture">
<h3>TakePicture<a class="headerlink" href="#takepicture" title="Permalink to this headline">¶</a></h3>
<p>This function takes three successive jpeg pictures at the highest camera resolution
(NAO v3.3 and below have a VGA camera, NAO v4 and above have an HD 960p camera).</p>
<p>Pictures are stored on the robot in &#8216;/home/nao/recordings/cameras/&#8217;.
To get them on your PC, you can use ssh or use the FTP browser in Choregraphe.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Taking 3 images allows the user to select the best one, as it could be found on
some compact cameras (don&#8217;t mistake with the bracketing mode).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A button is available in the Monitor GUI for taking pictures by calling this
function.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you need to shorten the delay between calling the function and
grabbing the first image, you can call the halfPress function. In a digital camera,
this will set the autofocus. Here, it will turn on the frame grabber if it was off
and set it in the highest resolution mode if resolution was lower. Calling again
halfPress function or taking a picture will return to the previous mode.</p>
</div>
</div>
<div class="section" id="takepictureregularly">
<h3>TakePictureRegularly<a class="headerlink" href="#takepictureregularly" title="Permalink to this headline">¶</a></h3>
<p>With this function, you can grab regularly an image from NAO. Several parameters
are available:</p>
<ul class="simple">
<li>the number of seconds between two pictures (e.g. several images per second,
one every 10 minutes, one per day, etc.);</li>
<li>the absolute path where the pictures should be recorded (eg.&#8221;/home/nao/recordings/cameras/&#8221;);</li>
<li>overwrite the pictures or add the timestamp to the name of the file;</li>
<li>the file format (e.g. jpg, bmp, png);</li>
<li>the pictures resolution (e.g. QQVGA).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can ask up to 8 instances for this function, recording images at different time
intervals and different format for different use.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TakePictureRegularly is a blocking function. To stop a specific instance,
call the stopTPR function by providing it the path and the root of the name
corresponding to this instance, as well as the file format, both elements
describing together a unique instance.</p>
</div>
<p>Finally, if you want to remember the different instances running currently, call
the logTPRInstanceInfo function. It prints this information in the logger.</p>
</div>
<div class="section" id="startvideorecord-and-stopvideorecord">
<h3>StartVideoRecord and StopVideoRecord<a class="headerlink" href="#startvideorecord-and-stopvideorecord" title="Permalink to this headline">¶</a></h3>
<p>These two functions are used to record AVI videos on the robot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Video recording can be quickly accessed using Monitor, which internally uses
VisionToolbox&#8217;s functions.</p>
</div>
<p>They are quite straightforward to use. Just call startVideoRecord passing the video
name as argument. NAO will then start to record what it can see with its active
camera. The record is done at a frame rate of 15 frames per second, 320*240 pixels,
with MJPG compression. Please note that the frame rate may go down below 15 fps
depending on what is running on the robot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">startVideoRecord is not a blocking function, it launches a separate thread that
performs the video recording.</p>
</div>
<p>When you want to stop the record, call stopVideoRecord. The record is then saved on
the robot in the user data section (&#8216;/home/nao/.local/share/naoqi/share/naoqi/vision&#8217; directory) using the
file name you specified.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please note that you can only have one active record at a time. If you want to know
if there is an active record, you can call isVideoRecording().</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">VisionToolbox also offers a &#8220;startVideoRecord_adv&#8221; function, which gives you access
to more parameters regarding your video record (frame rate, format, resolution, etc).
Please refer to <a class="reference internal" href="alvisiontoolbox-api.html#ALVisionToolboxProxy::startVideoRecord_adv__ssCR.floatCR.ssCR.iCR.iCR" title="ALVisionToolboxProxy::startVideoRecord_adv"><tt class="xref cpp cpp-func docutils literal"><span class="pre">ALVisionToolboxProxy::startVideoRecord_adv()</span></tt></a> for exact details.</p>
</div>
</div>
<div class="section" id="setwhitebalance">
<h3>SetWhiteBalance<a class="headerlink" href="#setwhitebalance" title="Permalink to this headline">¶</a></h3>
<p>This function is useful when you need to use the absolute color information
in the images.</p>
<p>As you might know, the automatic white balance is usually performing correctly.
However, colors perception drifts with the light temperature (expressed in
°K) and will still have effect on the automatic white balance, even if this mode
aims to reduce this effect. Moreover, the automatic white balance can&#8217;t work
properly when there is a dominent color in the image. So for instance, finding
a blue ball using its color will be a problem when the automatic white balance
is active, as this blue shape will delude the system trying to fix the correct
lengths for a neutral grey.</p>
<p>A solution is to look at a white or grey pattern used as a reference and to disable
the automatic white balance. This is what is done when calling setWhiteBalance
function: NAO looks at his hands and freezes the white balance lengths.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To avoid white balance calibration to be disturbed by NAOs leds of its eyes,
they are turned off before and restored at the end of the process.</p>
</div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to get started with most of these features is to use the corresponding Choregraphe vision boxes (Is BackLit, Is in Darkness).
Recording capabilities can be easily used through the camera panel of MONITOR.</p>
</div>
</div>


          </div>
          <div class="footernav">
    &laquo; <a href="alvisionrecognition-tuto.html" title="ALVisionRecognition Tutorial">ALVisionRecognition Tutorial</a>
     |
    <a href="index.html" title="NAOqi Vision" accesskey="U">NAOqi Vision</a>
   |
    <a href="alvisiontoolbox-api.html" title="ALVisionToolbox API">ALVisionToolbox API</a> &raquo;</div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <ul class="this-page-menu">
      <li><a href="../../_sources/naoqi/vision/alvisiontoolbox.txt"
             rel="nofollow">Show Source</a></li>
    </ul>


  <h3>Table Of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../news/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nao/index.html">NAO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/index.html">Programming Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../ref/index.html">References</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">NAOqi API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../core/index.html">NAOqi Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motion/index.html">NAOqi Motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../audio/index.html">NAOqi Audio</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">NAOqi Vision</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="alfacedetection.html">ALFaceDetection</a></li>
<li class="toctree-l4"><a class="reference internal" href="allandmarkdetection.html">ALLandMarkDetection</a></li>
<li class="toctree-l4"><a class="reference internal" href="alredballdetection.html">ALRedBallDetection</a></li>
<li class="toctree-l4"><a class="reference internal" href="alvideodevice.html">ALVideoDevice</a></li>
<li class="toctree-l4"><a class="reference internal" href="alvisionrecognition.html">ALVisionRecognition</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">ALVisionToolbox</a><ul>
<li class="toctree-l5"><a class="reference internal" href="alvisiontoolbox-api.html">ALVisionToolbox API</a></li>
<li class="toctree-l5"><a class="reference internal" href="alvisiontoolbox-tuto.html">ALVisionToolbox Tutorial</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sensors/index.html">NAOqi Sensors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trackers/index.html">NAOqi Trackers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sensors/dcm.html">DCM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stdtypes.html">Standard types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../cpp-classindex.html">&gt; All C++ Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cpp-funcindex.html">&gt; All C++ Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../naoqi-eventindex.html">&gt; All NAOqi Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../naoqi-memoryindex.html">&gt; All NAOqi Memory Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/cpp-api.html">C++ API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ref/python-api.html">Python API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../legal/notice.html">Legal notices</a></li>
</ul>

    <h3><a href="../../index.html">On this page</a></h3>
    <ul>
<li><a class="reference internal" href="#">ALVisionToolbox</a><ul>
<li><a class="reference internal" href="#what-it-does">What it does</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a><ul>
<li><a class="reference internal" href="#isitdark">IsItDark?</a></li>
<li><a class="reference internal" href="#backlighting">Backlighting</a></li>
<li><a class="reference internal" href="#takepicture">TakePicture</a></li>
<li><a class="reference internal" href="#takepictureregularly">TakePictureRegularly</a></li>
<li><a class="reference internal" href="#startvideorecord-and-stopvideorecord">StartVideoRecord and StopVideoRecord</a></li>
<li><a class="reference internal" href="#setwhitebalance">SetWhiteBalance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-started">Getting started</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="alvisionrecognition-tuto.html" title="ALVisionRecognition Tutorial">previous</a>
     |
    <a href="index.html" title="NAOqi Vision" accesskey="U">up</a>
   |
    <a href="alvisiontoolbox-api.html" title="ALVisionToolbox API">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>